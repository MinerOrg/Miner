name: Unreal Code Compile Check

on:
  pull_request:

jobs:
  compile:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup MSVC build environment
        uses: ilammy/msvc-dev-cmd@v1

      - name: Find C++ source files
        id: src
        shell: pwsh
        run: |
          $files = Get-ChildItem -Recurse -Include *.cpp | ForEach-Object { $_.FullName }
          "files=$($files -join ' ')" | Out-File -FilePath $env:GITHUB_OUTPUT -Append

      - name: Compile all C++ files (syntax only)
        shell: pwsh
        run: |
          $files = "${{ steps.src.outputs.files }}"
          if (-not $files) {
            Write-Host "No .cpp files found"
            exit 0
          }

          # Create output dir
          mkdir build -Force | Out-Null

          # Try compiling to .obj (object) files, without linking
          foreach ($f in $files.Split(' ')) {
            Write-Host "Compiling $f"
            cl.exe /c "$f" /Fo"build\" /EHsc /std:c++20
            if ($LASTEXITCODE -ne 0) { exit 1 }
          }
